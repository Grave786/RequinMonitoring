{% extends 'OrgDashboard.html' %}
{% block dashboard_content %}
<div class="row justify-content-center pt-4">
  <div class="col-12 mb-4">
    <div class="card shadow rounded-4 border-0 p-4">
      <h3 class="h3 text-center mb-4">View Employee Monitoring Logs</h3>

      {% if msg is not none and msg %}
      <div class="text-end mb-3">
        <button id="exportData" class="btn btn-success rounded-pill px-4">
          <i class="bi bi-download me-2"></i>Export Data
        </button>
      </div>

      <div class="table-responsive">
        <table id="exampleMoni" class="table table-hover table-centered table-nowrap mb-0 rounded">
          <thead class="thead-light">
            <tr>
              <th>Sr. No.</th>
              <th>Name</th>
              <th>Time Stamp</th>
              <th>Employee</th>
            </tr>
          </thead>
          <tbody>
            {% for result in msg %}
            <tr>
              <td>{{ forloop.counter }}</td>
              <td>{{ result.m_title }}</td>
              <td>{{ result.m_log_ts }}</td>
              <td>{{ result.e_id.e_name }}</td> 
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <div class="text-center">
        <lottie-player src="https://assets7.lottiefiles.com/datafiles/vhvOcuUkH41HdrL/data.json"
          background="transparent" speed="1" style="width: 300px; height: 300px;" loop autoplay></lottie-player>
        <h3 class="h3 text-center">No Records Found!</h3>
      </div>
      {% endif %}
    </div>
  </div>
</div>

<script>
$(document).ready(function () {
  const table = $('#exampleMoni').DataTable({
    dom: 'Bfrtip',
    buttons: ['copy', 'csv', 'excel', 'pdf', 'print'],
    pageLength: 25,
    order: [[2, 'desc']]
  });

  $('#exportData').on('click', function () {
    Swal.fire({
      title: 'Export Data',
      text: 'Choose your preferred export format:',
      icon: 'info',
      showConfirmButton: false,
      showCancelButton: true,
      cancelButtonText: 'Cancel',
      html: `
        <div class="d-flex flex-column gap-2">
          <button id="btnExportCSV" class="swal2-confirm swal2-styled" style="background-color:#2ecc71;">CSV</button>
          <button id="btnExportExcel" class="swal2-confirm swal2-styled" style="background-color:#3498db;">Excel</button>
          <button id="btnExportPDF" class="swal2-confirm swal2-styled" style="background-color:#e74c3c;">PDF</button>
          <button id="btnExportPrint" class="swal2-confirm swal2-styled" style="background-color:#95a5a6;">Print</button>
        </div>
      `,
      didOpen: () => {
        document.getElementById('btnExportCSV').addEventListener('click', () => { table.button(1).trigger(); Swal.close(); });
        document.getElementById('btnExportExcel').addEventListener('click', () => { table.button(2).trigger(); Swal.close(); });
        document.getElementById('btnExportPDF').addEventListener('click', () => { table.button(3).trigger(); Swal.close(); });
        document.getElementById('btnExportPrint').addEventListener('click', () => { table.button(4).trigger(); Swal.close(); });
      }
    });
  });
});
</script>
{% endblock %}
